<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI-Hair Assistance Dashboard</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAgCQd9jyG8ZSQeOdL6bzuiQaH2MJCh06I",
  authDomain: "ai-hair-assistant.firebaseapp.com",
  projectId: "ai-hair-assistant",
  storageBucket: "ai-hair-assistant.firebasestorage.app",
  messagingSenderId: "1098503832362",
  appId: "1:1098503832362:web:74413289c13dc2812cd453",
  measurementId: "G-9M2K7BMEED"
};

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Redirect if not logged in
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location = "login.html";
      } else {
        document.getElementById("welcome").innerText = `Welcome, ${user.email}`;
        loadUserData();
      }
    });

    // Logout function
    function logout() {
      signOut(auth).then(() => {
        window.location = "login.html";
      });
    }

    // Firestore: save user data
    async function saveData() {
      const hairProblem = document.getElementById("hairProblem").value;
      const hairGoal = document.getElementById("hairGoal").value;

      try {
        await addDoc(collection(db, "userData"), {
          uid: auth.currentUser.uid,
          hairProblem,
          hairGoal,
          timestamp: new Date()
        });
        alert("Data saved!");
        loadUserData(); // Refresh table
      } catch (error) {
        console.error("Error adding document: ", error);
      }
    }

    // Load user data from Firestore
    async function loadUserData() {
      const table = document.getElementById("dataTable");
      table.innerHTML = "<tr><th>Problem</th><th>Goal</th><th>Date</th></tr>";
      const querySnapshot = await getDocs(collection(db, "userData"));
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        if (data.uid === auth.currentUser.uid) {
          const row = table.insertRow();
          row.insertCell(0).innerText = data.hairProblem;
          row.insertCell(1).innerText = data.hairGoal;
          row.insertCell(2).innerText = data.timestamp.toDate();
        }
      });
    }

    window.logout = logout;
    window.saveData = saveData;
    document.addEventListener("DOMContentLoaded",() =>{
    document.getElementById("generateRoutine").addEventListener("click", async () => { console.log("Generate Routine button clicked");
  // Collect user inputs
  const hairType = document.getElementById("hairType").value;
  const scalpType = document.getElementById("scalpType").value;
  const problems = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);
  const climate = document.getElementById("climate").value;
  const washFrequency = document.getElementById("washFrequency").value;

  // Build prompt
 const prompt = `You are an AI hair care assistant. 
Generate a personalized hair care routine based on the following details:

Hair Type: ${hairType}
Scalp Type: ${scalpType}
Hair Problems: ${problems.join(", ")}
Climate: ${climate}
Wash Frequency: ${washFrequency}

Provide a detailed daily and weekly routine, including shampoo, conditioner, treatments, and tips. 
Write in simple, clear language suitable for a user to follow.`;
  // Call Gemini API
  try {
    const response = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=API key", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
    });
    const data = await response.json();
    console.log(data);
    const routine = data?.candidates?.[0]?.content?.parts?.[0]?.text || "No routine generated.";
    document.getElementById("aiRoutine").innerText = routine;
  } catch (error) {
    console.error(error);
    document.getElementById("aiRoutine").innerText = "Error generating routine.";
  }
}); });  
 
  </script>
</head>
<body>
  <h1 id="welcome">Welcome!</h1>
  <button onclick="logout()">Logout</button>

  <h2>Track Your Hair Care Goals</h2>
  <input type="text" id="hairProblem" placeholder="Your hair problem">
  <input type="text" id="hairGoal" placeholder="Your hair goal">
  <button onclick="saveData()">Save</button>
  
  <!-- Hair Type -->
<select id="hairType">
  <option value="straight">Straight</option>
  <option value="wavy">Wavy</option>
  <option value="curly">Curly</option>
  <option value="coily">Coily</option>
</select>

<!-- Scalp Type -->
<select id="scalpType">
  <option value="normal">Normal</option>
  <option value="oily">Oily</option>
  <option value="dry">Dry</option>
  <option value="sensitive">Sensitive</option>
</select>

<!-- Hair Problems (Checkboxes) -->
<label><input type="checkbox" value="hair fall"> Hair Fall</label>
<label><input type="checkbox" value="dandruff"> Dandruff</label>
<label><input type="checkbox" value="split ends"> Split Ends</label>

<!-- Climate -->
<select id="climate">
  <option value="tropical">Tropical</option>
  <option value="dry">Dry</option>
  <option value="cold">Cold</option>
  <option value="humid">Humid</option>
</select>

<!-- Wash Frequency -->
<select id="washFrequency">
  <option value="daily">Daily</option>
  <option value="every 2-3 days">Every 2-3 days</option>
  <option value="weekly">Weekly</option>
</select>

<!-- Generate Routine Button -->
<button id="generateRoutine">Generate Routine</button>

<!-- Div to display AI routine -->
<div id="aiRoutine"></div>

  <h3>Your Data</h3>
  <table id="dataTable" border="1"></table>
</body>

</html>
